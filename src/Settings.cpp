
// DON'T EDIT MANUALLY !!!!
// auto-generated by scripts/gen_settings.py !!!!

#include "BaseUtil.h"
#include "Settings.h"

struct StructPointerInfo;

typedef struct {
    int                  pointersCount;
    StructPointerInfo *  pointersInfo;
} StructDef;

// information about a single field
struct StructPointerInfo {
    // from the beginning of the struct
    int offset;
    // what kind of structure it points to, needed
    // for recursive application of the algorithm
    // NULL if that structure doesn't need fixup
    // (has no pointers)
    StructDef *def;
};



static void unserialize_struct_r(char *data, StructDef *def, char *base)
{
    for (int i=0; i < def->pointersCount; i++) {
        int off = def->pointersInfo[i].offset;
        StructDef *memberDef = def->pointersInfo[i].def;
        char *pval = base + off;
        Ptr<char> *ptrToPtr = (Ptr<char>*)(data + off);
        ptrToPtr->ptr = pval;
        if (memberDef)
            unserialize_struct_r(pval, memberDef, base);
    }
}

// a serialized format is a linear chunk of memory with pointers
// replaced with offsets from the beginning of the memory.
// to unserialize, we need to fix them up i.e. convert offsets
// to pointers
void unserialize_struct(char *data, StructDef *def)
{
    unserialize_struct_r(data, def, data);
}
